<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.2bc34804842d21550fa6.css">code[class*=language-],pre[class*=language-]{-moz-tab-size:4;-ms-hyphens:none;-o-tab-size:4;-webkit-hyphens:none;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal;word-wrap:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block;pointer-events:none}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}body{background-color:#f1f1f1}.line-numbers .line-numbers-rows{padding-left:.5em;padding-top:1em}.blog-post img{width:100%}.blog-post .language-text{padding-left:.25em;padding-right:.25em}</style><style data-href="/0.badd97838c5fb530e64e.css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-50d279861fb3cbfed809eae6ed8b9ac9.woff2) format("woff2"),url(/static/montserrat-latin-100-5e334eff013f12fbb8ed72c2a253f119.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-8c0705336558194799a8729840d7ed9d.woff2) format("woff2"),url(/static/montserrat-latin-100italic-03e19243272affe738654a157625ec26.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-4343d3d91a9446226e7a8bbb024111ad.woff2) format("woff2"),url(/static/montserrat-latin-200-f2022ecd65a0703ec3edcb7641709a75.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-116c4c4b14ef76b0555da09854512022.woff2) format("woff2"),url(/static/montserrat-latin-200italic-89614a6008fc5c60739012463d0ee7e6.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-d2ad295b60682a6537c358e06ea80c61.woff2) format("woff2"),url(/static/montserrat-latin-300-3a371ee0d175f5c2b15ce1d6b981dc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f6b6bf2431003f8142e800f9df157989.woff2) format("woff2"),url(/static/montserrat-latin-300italic-16521668f5f238098329cdd7d27c391e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-240a84447b78da0920fcb07e378f2c5f.woff2) format("woff2"),url(/static/montserrat-latin-400-b20cc131034316b1c85d0498fb9ed5c5.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-86172bb829de6be08b92512096b6aca6.woff2) format("woff2"),url(/static/montserrat-latin-400italic-9405e78785a55cf0e4ea7669d4616ea9.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-fb8d6b71dbe8d9294be43082936f649e.woff2) format("woff2"),url(/static/montserrat-latin-500-50825d47af7ae47e055018eb689c6c99.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c0a555a4f8e997385a3eebbd4da0b9ee.woff2) format("woff2"),url(/static/montserrat-latin-500italic-635de59c4be86285b1f70068c95b9816.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-d5615136a08cfee70deb4be1ee1651df.woff2) format("woff2"),url(/static/montserrat-latin-600-f300da4fb4fe00e23915f62b2c643681.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-10f29d139edacde92df63374c5672568.woff2) format("woff2"),url(/static/montserrat-latin-600italic-2bc37d86a4ba12ce526c4af904a9946e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7d77e1f03eefc452dab14d7f89080083.woff2) format("woff2"),url(/static/montserrat-latin-700-81826529772e52f0f14a4c73c2f2c7f1.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-1dd2b53f1567a29e0505de9b27c4352c.woff2) format("woff2"),url(/static/montserrat-latin-700italic-c162d257f5e9f9b108a96a604cfb2132.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-d4e7bf86bbd8e5f43ca73fa831218648.woff2) format("woff2"),url(/static/montserrat-latin-800-895aadbff357be35ac8dd107c7975ee7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-fc0cbe442f7b3733c91e982e825c4daa.woff2) format("woff2"),url(/static/montserrat-latin-800italic-b3362875067300abedb7a8fb97903258.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-c8bdd772c0d1347720ff7e3fb72719f3.woff2) format("woff2"),url(/static/montserrat-latin-900-1b99ef78e627dd9bbd0ca4b5c0789547.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-cb72c1f90f66c124fb897a75bec64c78.woff2) format("woff2"),url(/static/montserrat-latin-900italic-b78bb9f8ecec6c5a924c873f1818095f.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-f015f1e9a46a3b9db4fd64564dacece4.woff2) format("woff2"),url(/static/merriweather-latin-300-92dfe81b725c342d31d962da975c07a6.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-7fd86b32accf2df4403d1d4fa3a81502.woff2) format("woff2"),url(/static/merriweather-latin-300italic-878b76f59d5ba58dd1652dc8d2a0f4f9.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-12dbf4c00ae43698f278b099e4b0ec9e.woff2) format("woff2"),url(/static/merriweather-latin-400-1fffad22b085a877995812dbf1d9ac08.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-1e0d3e8121d88969bfb153c8f174b758.woff2) format("woff2"),url(/static/merriweather-latin-400italic-de18d4c4e8e808a7248a185f866ff094.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-dc8fec81a125fc63856587e6683da73b.woff2) format("woff2"),url(/static/merriweather-latin-700-d7d2ed8e58f303392cc3fc00ba3a9186.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-b7b7e5da4d7be8c12bd5a6c809edc8fc.woff2) format("woff2"),url(/static/merriweather-latin-700italic-6210a5fc1c54ca85a5d82aa85d7a9b5c.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-43f870d543dd89fbeb66d417c0d97276.woff2) format("woff2"),url(/static/merriweather-latin-900-8f3806df74937c7b8b53f24ae1e725d1.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-168c1ab28ed0e4e7d654334def288bc1.woff2) format("woff2"),url(/static/merriweather-latin-900italic-ae7778f01871e35ee142ef207b313b34.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.0.4"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><title data-react-helmet="true">Getting Started with Ecto Part 2: Migrations, Schemas, and Changeset | Edgar Pino&#x27;s Blog</title><meta data-react-helmet="true" name="description" content="Note: This post was updated to work with Ecto 3.0 Welcome to part two of Getting Started with Ecto. On the  last post , we covered how to…"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-e3eb2667abe3ee2908b9.js"/><link as="script" rel="preload" href="/0-0a079d50270e89f698df.js"/><link as="script" rel="preload" href="/app-ca0f430ff853a66bbd35.js"/><link as="script" rel="preload" href="/webpack-runtime-4796e8effd7057a7bdc4.js"/><link rel="preload" href="/static/d/924/path---getting-started-with-ecto-part-2-988-295-j8quulR4OnK1ZfvcmpYOx1I1Vk.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="background:#F55;width:100%;height:0.1225rem"></div><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Edgar Pino</a></h3><h1>Getting Started with Ecto Part 2: Migrations, Schemas, and Changeset</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">October 12, 2018</p><div class="blog-post"><blockquote>
<p>Note: This post was updated to work with Ecto 3.0</p>
</blockquote>
<p>Welcome to part two of Getting Started with Ecto. On the <a href="/getting-started-with-ecto-part-1/">last post</a>, we covered how to install and configure Ecto in our application. In this post we will cover migrations, schemas, and changesets in Ecto.</p>
<h2>Migrations</h2>
<p>Now that we have a database and Repo, we are going to create tables and columns. To do that, we will create migrations that define the structure of our tables and define any relationships. Before we create our first migration, let’s look at the database design of our demo application.</p>
<p><img src="/database-f6d1b6a1a6b5358b10c429995b038d48.svg" alt="Database design"></p>
<ul>
<li>Users have credentials with a unique email</li>
<li>Challenges have many solutions</li>
<li>Users can have one solution per challenge</li>
</ul>
<h4>Generating Migrations</h4>
<p>Let’s go ahead and create our first migration by running the following generator command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mix ecto.gen.migration create_users_table</code></pre></div>
<p>That will create a file inside of <code class="language-text">priv/repo/migrations/</code> that looks something like this:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">defmodule</span> GettingStartedWithEcto<span class="token punctuation">.</span>Repo<span class="token punctuation">.</span>Migrations<span class="token punctuation">.</span>CreateUsersTable <span class="token keyword">do</span>
  <span class="token keyword">use</span> Ecto<span class="token punctuation">.</span>Migration

  <span class="token keyword">def</span> change <span class="token keyword">do</span>

  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>Lets define our table inside the <a href="https://hexdocs.pm/ecto/Ecto.Migration.html#module-change"><code class="language-text">change</code></a> function; this allows us to create reversible migrations.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">def</span> change <span class="token keyword">do</span>
  create table<span class="token punctuation">(</span><span class="token atom symbol">:users</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    add<span class="token punctuation">(</span><span class="token atom symbol">:name</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">,</span> <span class="token attr-name">size:</span> <span class="token number">100</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token atom symbol">:age</span><span class="token punctuation">,</span> <span class="token atom symbol">:integer</span><span class="token punctuation">)</span>

    timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>The column name and type are defined as atoms. We defined the name as a string with a character limit of 100 and age is an integer. We also use the <code class="language-text">timestamps</code> function that adds <code class="language-text">:inserted_at</code> and <code class="language-text">:updated_at</code> timestamps columns. See the docs for other <a href="https://hexdocs.pm/ecto/Ecto.Schema.html#module-primitive-types">primitive types</a>.</p>
<h4>Running Migrations</h4>
<p>Now that we have our migrations, let’s run them with the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mix ecto.migrate</code></pre></div>
<p>You should see the following output if it succeded:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">16:07:36.057 <span class="token punctuation">[</span>info<span class="token punctuation">]</span>  <span class="token operator">==</span> Running GettingStartedWithEcto.Repo.Migrations.CreateUsersTable.change/0 forward
16:07:36.057 <span class="token punctuation">[</span>info<span class="token punctuation">]</span>  create table <span class="token function">users</span>
16:07:36.068 <span class="token punctuation">[</span>info<span class="token punctuation">]</span>  <span class="token operator">==</span> Migrated <span class="token keyword">in</span> 0.0s</code></pre></div>
<p>If we look at our database, we see two tables: <code class="language-text">schema_migrations</code> and <code class="language-text">users</code>. The <code class="language-text">schema_migrations</code> keeps track of our migrations and the order they were executed. This allows Ecto to rollback migrations by using the <code class="language-text">mix ecto.rollback</code> command.</p>
<p>Let’s move on to the <code class="language-text">credentials</code> migration. I won’t go over how to generate and run migrations since that’s been covered. This is how our credentials migration should look like:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">defmodule</span> GettingStartedWithEcto<span class="token punctuation">.</span>Repo<span class="token punctuation">.</span>Migrations<span class="token punctuation">.</span>CreateCredentialsTable <span class="token keyword">do</span>
  <span class="token keyword">use</span> Ecto<span class="token punctuation">.</span>Migration

  <span class="token keyword">def</span> change <span class="token keyword">do</span>
    create table<span class="token punctuation">(</span><span class="token atom symbol">:credentials</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
      add<span class="token punctuation">(</span><span class="token atom symbol">:email</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
      add<span class="token punctuation">(</span><span class="token atom symbol">:password_hash</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
      add<span class="token punctuation">(</span><span class="token atom symbol">:user_id</span><span class="token punctuation">,</span> references<span class="token punctuation">(</span><span class="token atom symbol">:users</span><span class="token punctuation">,</span> <span class="token attr-name">on_delete:</span> <span class="token atom symbol">:delete_all</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token attr-name">null:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

      timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    create<span class="token punctuation">(</span>unique_index<span class="token punctuation">(</span><span class="token atom symbol">:credentials</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token atom symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    create<span class="token punctuation">(</span>index<span class="token punctuation">(</span><span class="token atom symbol">:credentials</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token atom symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>Notice that our <code class="language-text">user_id</code> references the <code class="language-text">users</code> table. We set the <code class="language-text">:on_delete</code> to <code class="language-text">:delete_all</code> which deletes the <code class="language-text">credentials</code> record when the user record is deleted. Check out the <a href="https://hexdocs.pm/ecto/Ecto.Migration.html#references/2-options">Ecto docs</a> for other supported options. Lastly, we set <code class="language-text">null</code> to <code class="language-text">false</code> which prevents the <code class="language-text">user_id</code> from being <code class="language-text">null</code>.</p>
<p>We also created an index on the <code class="language-text">email</code> and a unique index on the <code class="language-text">user_id</code> columns.
See the <a href="https://hexdocs.pm/ecto/Ecto.Migration.html#unique_index/3"><code class="language-text">unique_index</code></a> and <a href="https://hexdocs.pm/ecto/Ecto.Migration.html#index/3"><code class="language-text">index</code></a> functions for more info.</p>
<p>Our <code class="language-text">solutions</code> and <code class="language-text">challenges</code> migrations don’t cover anything new so I will skip them but check out the <a href="https://github.com/edgar971/getting_started_with_ecto/tree/master/priv/repo/migrations">source code</a> reference.</p>
<p>Let’s move on to schemas.</p>
<h2>Schemas</h2>
<p>Schemas are modules that represent data from our database. They define the table and column mapping, help functions, and changesets.
It’s our database, but in code.</p>
<h4>Creating Schemas</h4>
<p>Let’s create our first schema by creating a directory inside the <code class="language-text">lib</code> directory. We currently don’t have a generator command so we have to create the directories and files manually 😥. In our demo app, it will be in <code class="language-text">lib/getting_started_with_ecto/accounts/user.ex</code> and it looks like this:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">defmodule</span> GettingStartedWithEcto<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span>User <span class="token keyword">do</span>
  <span class="token keyword">use</span> Ecto<span class="token punctuation">.</span>Schema

  schema <span class="token string">"users"</span> <span class="token keyword">do</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:name</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:age</span><span class="token punctuation">,</span> <span class="token atom symbol">:integer</span><span class="token punctuation">)</span>

    timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>We use the <a href="https://hexdocs.pm/ecto/Ecto.Schema.html#content"><code class="language-text">schema</code></a> macro to map the user’s table and columns to a struct.
We define the name column to a string and the age as an integer. Lastly, we call the <a href="Generates%20:inserted_at%20and%20:updated_at%20timestamp%20fields"><code class="language-text">timestamps</code></a> function to generate the <code class="language-text">:inserted_at</code> and <code class="language-text">:updated_at</code> timestamp fields.</p>
<h4>Schema Relationships</h4>
<p>Let’s create the <code class="language-text">credentials</code> schema. In our demo app, it will be in <code class="language-text">lib/getting_started_with_ecto/accounts/user.ex</code>:</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">defmodule</span> GettingStartedWithEcto<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span>Credential <span class="token keyword">do</span>
  <span class="token keyword">use</span> Ecto<span class="token punctuation">.</span>Schema
  <span class="token keyword">alias</span> GettingStartedWithEcto<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span>User

  schema <span class="token string">"credentials"</span> <span class="token keyword">do</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:email</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:password_hash</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
    belongs_to<span class="token punctuation">(</span><span class="token atom symbol">:user</span><span class="token punctuation">,</span> User<span class="token punctuation">)</span>

    timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>The new thing here is how we define our one-to-one relationship with the <code class="language-text">user</code> schema. We use the <a href="https://hexdocs.pm/ecto/Ecto.Schema.html#belongs_to/3"><code class="language-text">belongs_to</code></a> which does most of the work for us. Notice the first parameter is the name of the relationship and the second parameter is the <code class="language-text">User</code> schema.</p>
<p>We also want to get the credentials when querying the user, let’s add that to our <code class="language-text">User</code> schema. We will do that by adding <code class="language-text">has_one(:credential, Credential)</code> to the <code class="language-text">User</code> schema file.</p>
<div class="gatsby-highlight" data-language="elixir"><pre class="language-elixir"><code class="language-elixir"><span class="token keyword">defmodule</span> GettingStartedWithEcto<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span>User <span class="token keyword">do</span>
  <span class="token keyword">use</span> Ecto<span class="token punctuation">.</span>Schema
  <span class="token keyword">alias</span> GettingStartedWithEcto<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span>Credential

  schema <span class="token string">"users"</span> <span class="token keyword">do</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:name</span><span class="token punctuation">,</span> <span class="token atom symbol">:string</span><span class="token punctuation">)</span>
    field<span class="token punctuation">(</span><span class="token atom symbol">:age</span><span class="token punctuation">,</span> <span class="token atom symbol">:integer</span><span class="token punctuation">)</span>
    has_one<span class="token punctuation">(</span><span class="token atom symbol">:credential</span><span class="token punctuation">,</span> Credential<span class="token punctuation">)</span>

    timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>NOTE: Don’t forget to add the <code class="language-text">GettingStartedWithEcto.Accounts.Credential</code> alias at the top of the file.</p>
<p>If your schema has one-to-many association you can use the <a href="https://hexdocs.pm/ecto/Ecto.Schema.html#has_many/3"><code class="language-text">has_many</code></a>.</p>
<p>Our <code class="language-text">solution</code> and <code class="language-text">challenge</code> schemas don’t cover anything new so I will skip them but check out the <a href="https://github.com/edgar971/getting_started_with_ecto/tree/master/lib/getting_started_with_ecto/challenges">source code</a> reference.</p>
<p>Let’s move on to changesets.</p>
<h2>Schema Changesets</h2>
<p>The changeset is a function in the schema that allows us to filter and cast our schema fields, as well as track and validate data before it gets to the database.</p>
<h4>Defining Changesets</h4>
<p>Let’s define the <code class="language-text">changeset</code> function for our <code class="language-text">user</code> schema file:</p>
<div class="gatsby-highlight" data-language="elixir "><pre style="counter-reset: linenumber 0" class="language-elixir  line-numbers"><code class="language-elixir ">defmodule GettingStartedWithEcto.Accounts.User do
  use Ecto.Schema
  import Ecto.Changeset
  alias GettingStartedWithEcto.Accounts.Credential

  schema &quot;users&quot; do
    field(:name, :string)
    field(:age, :integer)
    has_one(:credential, Credential)

    timestamps()
  end

  def changeset(user, attrs) do
    user
    |&gt; cast(attrs, [:name, :age])
    |&gt; validate_required([:name], message: &quot;Full name is required.&quot;, trim: true)
    |&gt; validate_inclusion(:age, 0..120, message: &quot;You need to be human.&quot;)
  end
end</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We first imported the <code class="language-text">Ecto.Changeset</code> and then we defined our <code class="language-text">changeset</code> function with two arguments. The <code class="language-text">user</code> argument can be
a changeset, schema struc, or a tuple with <code class="language-text">{data, types}</code>. The <code class="language-text">attrs</code> argument is a map like <code class="language-text">%{&quot;name&quot; =&gt; &quot;Alan&quot;}</code> or <code class="language-text">%{name: &quot;Alan&quot;}</code>.</p>
<p>Let’s look at the internals of this function.</p>
<p>In line 17, we piped the <code class="language-text">user</code> to the <code class="language-text">cast</code> function which applies the <code class="language-text">attrs</code> changes to the <code class="language-text">user</code> given a set of allowed keys. In this example, the keys are <code class="language-text">[:name, :age]</code> since those are our schema fields. This means that any other values in the <code class="language-text">attrs</code> map will be ignored and filtered out. Lastly, the <code class="language-text">cast</code> function returns a changeset if everything was successful.</p>
<p>Line 18 is straightforward. We make the <code class="language-text">name</code> field required. <a href="https://hexdocs.pm/ecto/Ecto.Changeset.html#validate_required/3"><code class="language-text">validate_required</code></a> has an optional third argument
to add a custom message or trim whitespaces.</p>
<p>Finally, we use the <a href="https://hexdocs.pm/ecto/Ecto.Changeset.html#validate_inclusion/4"><code class="language-text">validate_inclusion</code></a> to validate that our age is between 0 and 120. An optional third argument can be provided for a custom message.</p>
<p>Ecto provides other validation function out of the box, check out the <a href="https://hexdocs.pm/ecto/search.html?q=validate">Ecto docs</a> for more.</p>
<p>Let’s move on to creating custom validation functions.</p>
<h4>Custom Validation Function</h4>
<p>We can also define custom functions to validate or change any of the fields in the changeset. Let’s create a
function that checks if the word ‘Elixir’ is part of the <code class="language-text">password_hash</code> field. </p>
<p>Define our <code class="language-text">credentials</code> changeset inside it’s appropiate schema file. </p>
<div class="gatsby-highlight" data-language="elixir "><pre style="counter-reset: linenumber 0" class="language-elixir  line-numbers"><code class="language-elixir ">def changeset(credentials, attrs) do
  credentials
  |&gt; cast(attrs, [:email, :password_hash])
  |&gt; cast_assoc(:user)
  |&gt; validate_required([:email, :password_hash])
  |&gt; validate_password()
  |&gt; validate_format(:email, ~r/@/)
  |&gt; unique_constraint(:email)
end

defp validate_password(changeset) do
  isValid =
    changeset
    |&gt; get_change(:password_hash)
    |&gt; String.contains?(&quot;Elixir&quot;)

  case isValid do
    true -&gt; changeset
    false -&gt; password_invalid(changeset)
  end
end

defp password_invalid(changeset) do
  add_error(changeset, :password_hash, &quot;Invalid password, missing secret word.&quot;)
end</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This changeset is a little more complex since we have more validation. </p>
<p>In line 4, the <code class="language-text">:user</code> association gets casts with its own changeset. This allows us to create or update the user associated with the credentials. </p>
<p>In line 6, we call our custom <code class="language-text">validate_password</code> validator function. This function does a simple check on the string
to determine if the word “Elixir” appears within the <code class="language-text">validate_password</code>. It returns the changeset for a valid password, or calls the <code class="language-text">password_invalid</code> function which returns the changeset with an error.</p>
<p>Custom validator functions are flexible and allow you to validate changesets with more granularity. </p>
<p>Our <code class="language-text">solution</code> and <code class="language-text">challenge</code> changeset don’t cover anything new so I will skip them, but check out the <a href="https://github.com/edgar971/getting_started_with_ecto/tree/master/lib/getting_started_with_ecto/challenges">source code</a> reference.</p>
<h2>Congratulations 🎉 🎉 🎉</h2>
<p>We covered a lot of Ecto concepts in this post. We learned how to create migrations, schemas, and changesets.
If you need more information or have a question, feel free to leave a comment or check out the <a href="https://hexdocs.pm/ecto/Ecto.html">Ecto documentation</a>. On the next post, we will start using our Repo to make database queries.</p></div><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:4.375rem"><img src="/static/profile-pic-d431fbd3a6c128e3f19f18e0e2386b37.jpg" alt="Edgar Pino" style="margin-right:0.875rem;margin-bottom:0;border-radius:50%;width:3.5rem;height:3.5rem"/><p>Software Engineer @Pluralsight. Interested in distributed systems, machine learning, and the web.<!-- --> <a href="https://twitter.com/edgar971">Follow me on Twitter.</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/getting-started-with-ecto-part-1/">← <!-- -->Getting Started with Ecto Part 1: Installing and Configuring Ecto</a></li><li><a rel="next" href="/getting-started-with-ecto-part-3/">Getting Started with Ecto Part 3: CRUD Operations<!-- --> →</a></li></ul></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-36592716-4', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"getting-started-with-ecto-part-2-988","path":"/getting-started-with-ecto-part-2/"};window.dataPath="924/path---getting-started-with-ecto-part-2-988-295-j8quulR4OnK1ZfvcmpYOx1I1Vk";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.2bc34804842d21550fa6.css","/app-ca0f430ff853a66bbd35.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-649e7dc1d705385d876c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e3eb2667abe3ee2908b9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-3611a2dc702c1fe09907.js"],"component---src-pages-index-js":["/component---src-pages-index-js-19bf76cd8180d13cda1a.js"]};/*]]>*/</script><script src="/webpack-runtime-4796e8effd7057a7bdc4.js" async=""></script><script src="/app-ca0f430ff853a66bbd35.js" async=""></script><script src="/0-0a079d50270e89f698df.js" async=""></script><script src="/component---src-templates-blog-post-js-e3eb2667abe3ee2908b9.js" async=""></script></body></html>