{"data":{"site":{"siteMetadata":{"title":"Edgar Pino's Blog","author":"Edgar Pino"}},"markdownRemark":{"id":"3413e355-82df-54d7-a765-c2f929759acc","excerpt":"Welcome to part two of Getting Started with Ecto. In the last post we covered how to install and configure Ecto in our application. In this…","html":"<p>Welcome to part two of Getting Started with Ecto. In the last post we covered how to install and configure Ecto in our application. In this post we will cover migrations, schemas, changesets, and how to execute simple queries in Ecto.</p>\n<h2>Migrations</h2>\n<p>Now that we have a database, we are going to create tables and columns. To do that, we will create migrations that define the structure of our tables and define any relationships. Before we create our first migration, let’s look at the database design of our demo application.</p>\n<p><img src=\"/database-f6d1b6a1a6b5358b10c429995b038d48.svg\" alt=\"Database design\"></p>\n<ul>\n<li>Users have credentials with a unique email</li>\n<li>Challenges have many solutions.</li>\n<li>Users can have one solution per challenge.</li>\n</ul>\n<h4>Generating Migrations</h4>\n<p>Lets go ahead and create our first migration by running the following generator command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mix ecto.gen.migration create_users_table</code></pre></div>\n<p>That will create a file inside of <code class=\"language-text\">priv/repo/migrations/</code> that looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"elixir\"><pre class=\"language-elixir\"><code class=\"language-elixir\"><span class=\"token keyword\">defmodule</span> GettingStartedWithEcto<span class=\"token punctuation\">.</span>Repo<span class=\"token punctuation\">.</span>Migrations<span class=\"token punctuation\">.</span>CreateUsersTable <span class=\"token keyword\">do</span>\n  <span class=\"token keyword\">use</span> Ecto<span class=\"token punctuation\">.</span>Migration\n\n  <span class=\"token keyword\">def</span> change <span class=\"token keyword\">do</span>\n\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Let’s define our table inside the <a href=\"https://hexdocs.pm/ecto/Ecto.Migration.html#module-change\"><code class=\"language-text\">change</code></a> function that allows us to create reversible migrations.</p>\n<div class=\"gatsby-highlight\" data-language=\"elixir\"><pre class=\"language-elixir\"><code class=\"language-elixir\"><span class=\"token keyword\">def</span> change <span class=\"token keyword\">do</span>\n  create table<span class=\"token punctuation\">(</span><span class=\"token atom symbol\">:users</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n    add<span class=\"token punctuation\">(</span><span class=\"token atom symbol\">:name</span><span class=\"token punctuation\">,</span> <span class=\"token atom symbol\">:string</span><span class=\"token punctuation\">)</span>\n    add<span class=\"token punctuation\">(</span><span class=\"token atom symbol\">:age</span><span class=\"token punctuation\">,</span> <span class=\"token atom symbol\">:integer</span><span class=\"token punctuation\">)</span>\n\n    timestamps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>The column name and type are defined as atoms. Name is a string and age is an integer. We also use the <code class=\"language-text\">timestamps</code> function that adds <code class=\"language-text\">:inserted_at</code> and <code class=\"language-text\">:updated_at</code> timestamps columns. See the docs for other <a href=\"https://hexdocs.pm/ecto/Ecto.Schema.html#module-primitive-types\">primitive types</a>.</p>\n<p>Now that we have our migrations, let’s run them with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mix ecto.migrate</code></pre></div>\n<p>You should see the following output if it succeded:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">16:07:36.057 <span class=\"token punctuation\">[</span>info<span class=\"token punctuation\">]</span>  <span class=\"token operator\">==</span> Running GettingStartedWithEcto.Repo.Migrations.CreateUsersTable.change/0 forward\n16:07:36.057 <span class=\"token punctuation\">[</span>info<span class=\"token punctuation\">]</span>  create table <span class=\"token function\">users</span>\n16:07:36.068 <span class=\"token punctuation\">[</span>info<span class=\"token punctuation\">]</span>  <span class=\"token operator\">==</span> Migrated <span class=\"token keyword\">in</span> 0.0s</code></pre></div>\n<p>If we look at our database, we see two tables: schema<em>migrations and users. The schema</em>migrations keeps track of our migrations and the order they were executed. </p>\n<h2>Schemas</h2>\n<h2>Schema Changesets</h2>","frontmatter":{"title":"Getting Started with Ecto: Part 2","date":"October 03, 2018"}}},"pageContext":{"slug":"/getting-started-with-ecto-part-2/","previous":{"fields":{"slug":"/getting-started-with-ecto-part-1/"},"frontmatter":{"title":"Getting Started with Ecto: Part 1"}},"next":null}}